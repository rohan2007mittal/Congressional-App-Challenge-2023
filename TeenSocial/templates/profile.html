{% extends "layout.html" %}

{% block title %}
    Social App
{% endblock %}

{% block body %}
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.9.4/Chart.js"></script>
<!-- some parts are public and some private to just the user -->
<!-- public: -->

    <h1>Profile: {{ user.username }}</h1>
    {% if request.user.username == user.username %}
        <a href="{% url 'user_settings' %}">Account Settings</a>
        <br>
    {% endif %}

    {% load static %}
    <img src="/media/{{ user.profile_img }}" class="profile" style="border: 5px solid lightblue; border-radius: 50%; height: 200px; width: 200px;">
    

    <h2>Bio</h2>
    <p>{{ user.bio }}</p>
    {% if user.bio == "" %}
        <p>No Bio Added</p>
    {% endif %}

    {% if user.isPublic or user == request.user %}
        <h3>User Stats</h3>
        <h4>{{ total_days }} Total Days Free</h4>
        <h4>{{ streak }} Day Streak</h4>
        <h4>#{{ activity_rank.0 }} Ranked by Activity ({{ activity_rank.1 }})</h4>
        <h4>{{ percent }}% Improved Mood</h4>

        <h3>Mood Graph</h3>
        <!-- figure out -->
        <canvas id="moodGraph" style="width:100%;max-width:700px"></canvas>
        
        
        <!-- get all badges -->
        {% if num_goals >= 2 %}
            <h3>Badges</h3>
        {% else %}
            <h3>No Badges Yet</h3>
        {% endif %}
        {% load static %}
        {% if num_goals >= 8 %}
            <img height="300" src="{% static 'SocialApp/year_badge.png' %}">
            <img height="300" src="{% static 'SocialApp/month_badge.png' %}">
            <img height="300" src="{% static 'SocialApp/week_badge.png' %}">
        {% elif num_goals >= 4 %}
            <img height="300" src="{% static 'SocialApp/month_badge.png' %}">
            <img height="300" src="{% static 'SocialApp/week_badge.png' %}">
        {% elif num_goals >= 2 %}
            <img height="300" src="{% static 'SocialApp/week_badge.png' %}">
        {% endif %}

        <h3>Past Journal Entries</h3>
        {% for journal in journals %}
        <li>
            <ul><b>{{ journal.1 }}:</b> {{ journal.0 }}</ul>
        </li>
        {% endfor %}

    {% else %}
        <!-- image of a lock -->
        <p>Account is private</p>
    {% endif %}

<!-- private: (unless there is a setting to toggle private/public)-->
    <!-- individual progress -->
    
{% endblock %}
{% block script %}
    <script>
        const xValues = {{ x }};
        const yValues = {{ y }};

        console.log("xValues");
        console.log(xValues);
        console.log("yValues");

        const myChart = new Chart(document.getElementById("moodGraph"), {
            type: "line",
            data: {
                labels: xValues,
                datasets: [{
                    label: "Mindset Growth",
                    backgroundColor:"rgba(0,0,255,1.0)",
                    borderColor: "rgba(0,0,255,0.1)",
                    data: yValues,
                    fill: false,
                }]

            },
            options: {
                scales: {
                    yAxes: [{
                        ticks: {
                            suggestedMin: 0,
                            max: Math.max(...yValues) + 2,
                        },
                        scaleLabel: {
                            display: true,
                            labelString: "Mood Index"
                        }
                    }],
                    xAxes: [{
                        scaleLabel: {
                            display: true,
                            labelString: "Days"
                        }
                    }]
                },
                title : {
                    display : true,
                    text : 'Mindset Growth vs. Time'
                }
            }
        });


    </script>

   {% endblock %}
